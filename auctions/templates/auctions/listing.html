{% extends "auctions/layout.html" %}
{% load humanize %}

{% block title %}{{ listing.title }} &middot Auctions{% endblock %}

{% block body %}
    
        <div class="container-fluid">
            <div class="row margins">
                {% if user.is_authenticated %}
                <div class="col-lg-6 border description">
                    <h2 class="listing-listing_title">{{ listing.title }}</h2>
                    <h6 class="user"> Posted by 
                        {% if listing.user != request.user %}
                            {{ listing.user}}
                        {% else %}
                            You
                        {% endif %}
                    </h6>
                    <div class="listing-listing_categories">Categories: {% for category in listing.categories.all %}{{ category }} {% endfor %} </div>
                    <div class="listing-listing_description">{{ listing.description }}</div>
                    <!-- watchlist section -->
                    {% if listing in watchlist %}
                        <form action="{% url 'listing' listing.title %}" method="POST">
                            {% csrf_token %} 
                            <input type="submit" name="action" value="Delete from Watchlist">
                        </form>
                    {% else %}
                        <form action="{% url 'listing' listing.title %}" method="POST">
                            {% csrf_token %} 
                            <input type="submit" name="action" value="Add to Watchlist">
                        </form>
                    {% endif %}
                    <!-- bid section -->
                    {% if listing.user != request.user %}
                        <form action="{% url 'listing' listing.title %}" method="POST">
                            <label>Place a Bid:</label>
                            {% csrf_token %}
                            <input name="bid" type="number" min="{{ bid_limit }}" step="0.01">
                            <input type="submit" name="action" value="Bid">
                        </form>
                    {% endif %}
                </div>
                <div class="col-lg-6 border image">
                    <!-- img section  -->
                    <img class="listing-listing_image" src="{{ listing.image }}" alt="{{ listing.title }} image">
                    <!-- current bid section -->
                    <div class="listing-listing_current_bid">Current Bid: $ {{ listing.current_bid|intcomma }}</div>
                </div>
                <div class="col-12 border comments">
                    <!-- comment section -->
                    <h6>Comments:</h6>
                    {% for comment in comments %}
                        {% if comment.active == True %}
                            <div>{{ comment.user }} @ {{ comment.date }}</div>
                            <div>{{ comment.body }}</div>
                        {% endif %}
                    {% endfor %}
                    <!-- add comment section  -->
                    <form action="{% url 'listing' listing.title %}" method="POST">
                        {% csrf_token %} 
                        <div>{{ user.username }} @ {{ datetime }}  </div>
                        <input type="text" name="body" placeholder="Add a public comment">
                        <input type="submit" name="action" value="Comment">
                    </form>
                </div>
                {% else %}
                <div class="col-12 border text-center">
                    <h4> Please <b>Log in</b> to see this listing. </h4>
                </div>
                {% endif %}
            </div>
        </div>
{% endblock %}